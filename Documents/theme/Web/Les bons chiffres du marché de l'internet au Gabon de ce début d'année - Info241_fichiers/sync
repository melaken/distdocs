(function() {window.CONFIG_CSM_DOMAIN_NAME="csm.nl.eu.criteo.net"; window.CALLER_ID="147"; var CONFIG_JS_CALLBACK=criteoCallback; var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};function __extends(e,t){function o(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}function getCookie(e){for(var t=document.cookie.split(";"),o=0;o<t.length;o++){var r=t[o],n=r.substr(0,r.indexOf("=")).replace(/^\s+|\s+$/g,""),i=r.substr(r.indexOf("=")+1);if(n===e&&i)return decodeURIComponent(i)}return null}function setCookieOnMainDomain(e,t,o){var r=new Date;r.setTime(r.getTime()+60*o*60*1e3);for(var n="expires="+r.toUTCString(),i=document.location.hostname.split("."),a=null,s=0;s<i.length;++s){var u="domain=."+(a=i.slice(i.length-s-1,i.length).join("."));document.cookie=e+"="+encodeURIComponent(t)+";"+n+";"+u+";path=/";var l=getCookie(e);if(l&&l===t)break}return a||document.location}function deleteCookie(e){setCookieOnMainDomain(e,"",0)}var StorageOrigin,PrivateModeStatus,hasStorages=window.localStorage&&window.sessionStorage;function setItem(e,t){if(hasStorages)try{window.localStorage.setItem(e,t)}catch(e){}}function getItem(e){return hasStorages?localStorage.getItem(e):null}function removeItem(e){if(hasStorages)return localStorage.removeItem(e)}function getFromAllStorages(e,t){var o=getCookie(e),r=getItem(e);return o||r?t(o||r,(o&&StorageOrigin.Cookie)|(r&&StorageOrigin.LocalStorage)):t(null,StorageOrigin.None)}!function(e){e[e.None=0]="None",e[e.Cookie=1]="Cookie",e[e.LocalStorage=2]="LocalStorage"}(StorageOrigin||(StorageOrigin={})),function(e){e[e.Unknown=0]="Unknown",e[e.Deactivated=1]="Deactivated",e[e.Activated=2]="Activated"}(PrivateModeStatus||(PrivateModeStatus={}));var StorableUserData=function(){function e(e,t,o,r){this.storageKey=e,this.expirationTimeHours=t,this.value=o,this.origin=r}return e.prototype.hasValue=function(){return""!==String(this.value)&&null!==this.value&&void 0!==this.value},e.prototype.saveOnAllStorages=function(){if(this.hasValue()){var e="boolean"==typeof this.value?this.value?"1":"0":String(this.value);setCookieOnMainDomain(this.storageKey,e,this.expirationTimeHours),setItem(this.storageKey,e)}},e.prototype.toJSON=function(){return{value:this.value,origin:this.origin}},e.prototype.removeFromAllStorages=function(){deleteCookie(this.storageKey),removeItem(this.storageKey)},e.prototype.fromAllStorages=function(e){return getFromAllStorages(this.storageKey,e)},e}(),Sid=function(o){function r(e,t){return o.call(this,"cto_sid",9360,e,t)||this}return __extends(r,o),r.fromAllStorages=function(){return getFromAllStorages("cto_sid",function(e,t){return new r(e,t)})},r.fromValue=function(e){return new r(e,StorageOrigin.None)},r}(StorableUserData),Idfs=function(o){function r(e,t){return o.call(this,"cto_idfs",9360,e,t)||this}return __extends(r,o),r.fromAllStorages=function(){return getFromAllStorages("cto_idfs",function(e,t){return new r(e,t)})},r.fromValue=function(e){return new r(e,StorageOrigin.None)},r}(StorableUserData),IdCopy=function(o){function r(e,t){return o.call(this,"cto_idcpy",9360,e,t)||this}return __extends(r,o),r.fromAllStorages=function(){return getFromAllStorages("cto_idcpy",function(e,t){return new r(e,t)})},r.fromValue=function(e){return new r(e,StorageOrigin.None)},r}(StorableUserData),LocalWebId=function(o){function r(e,t){return o.call(this,"cto_lwid",9360,e,t)||this}return __extends(r,o),r.fromAllStorages=function(){return getFromAllStorages("cto_lwid",function(e,t){return new r(e,t)})},r.fromValue=function(e){return new r(e,StorageOrigin.None)},r}(StorableUserData),Optout=function(o){function r(e,t){return o.call(this,"cto_optout",43200,e,t)||this}return __extends(r,o),r.fromAllStorages=function(){return getFromAllStorages("cto_optout",function(e,t){return new r("1"===e,t)})},r.fromValue=function(e){return new r(e,StorageOrigin.None)},r}(StorableUserData),eventQueue=[],SYNCFRAME_ID="criteo-syncframe",SYNCFRAME_URL="https://gum.criteo.com/syncframe",idfs=Idfs.fromAllStorages(),idcpy=IdCopy.fromAllStorages(),optout=Optout.fromAllStorages(),sid=Sid.fromAllStorages(),lwid=LocalWebId.fromAllStorages(),hasFetchAPI="function"==typeof window.fetch,rtusResponseFromLocalStorage=null,FETCHED_CALLED=!1,CURRENT_SCRIPT_SRC=document.currentScript.src,RTUS_RESPONSE_LS_KEY="cto_rtus",JSON_DELIMITER_REGEX=/\(({[^}]*})\)/g,JS_CALLBACK=CONFIG_JS_CALLBACK||function(e){},DEFAULT_RTUS_RESPONSE={status:"Unknown",userid:""},generateUuid=function(){var o=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(o+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(o+16*Math.random())%16|0;return o=Math.floor(o/16),("x"===e?t:3&t|8).toString(16)})},syncframeListener=function(e){var t=e.data;t&&t.isCriteoMessage&&hasFetchAPI&&(e.stopImmediatePropagation(),t.optout?(logCounter("Origin.FromSyncframeOptout"),idfs.removeFromAllStorages(),sid.removeFromAllStorages(),idcpy.removeFromAllStorages(),(optout=Optout.fromValue(!0)).saveOnAllStorages(),fetchGumResponseAndStoreItInLocalStorage(null,null,optout,null)):(t.idfs&&(logCounter("Origin.FromSyncframeIdfs"),Idfs.fromValue(t.idfs).saveOnAllStorages()),t.uid&&(logCounter("Origin.FromSyncframeIdcpy"),IdCopy.fromValue(t.uid).saveOnAllStorages()),t.removeSid?(logCounter("Origin.FromSyncframeRemoveSid"),sid.removeFromAllStorages(),removeItem(RTUS_RESPONSE_LS_KEY)):t.sid&&(logCounter("Origin.FromSyncframeSid"),Sid.fromValue(t.sid).saveOnAllStorages()),t.idfs||t.sid||t.uid?fetchGumResponseAndStoreItInLocalStorage(Idfs.fromValue(t.idfs),Sid.fromValue(t.sid),Optout.fromValue(!1),IdCopy.fromValue(t.uid)):sendMetrics()))};function fetchGumResponseAndStoreItInLocalStorage(e,t,o,r){if(FETCHED_CALLED)sendMetrics();else{var n=new Headers;e&&e.hasValue()&&(n.set("X-CRTO-IDFS",e.value),logCounter("Headers.Idfs")),t&&t.hasValue()&&(n.set("X-CRTO-SID",t.value),logCounter("Headers.Sid")),o&&o.value&&(n.set("X-CRTO-OPTOUT","1"),logCounter("Headers.Optout")),r&&r.hasValue()&&(n.set("X-CRTO-IDCPY",r.value),logCounter("Headers.Idpcy")),logCounter("Events.InitiateFetch"),fetch(CURRENT_SCRIPT_SRC,{headers:n,cache:"reload",mode:"cors"}).then(function(e){return e.text().then(function(e){if(FETCHED_CALLED=!0,!(0<e.indexOf('"status":"Unknown"'))){var t=JSON_DELIMITER_REGEX.exec(e);t&&t[1]&&(setItem(RTUS_RESPONSE_LS_KEY,t[1]),logCounter("Events.SaveResponseOnLocalStorage")),sendMetrics()}})}).catch(logCounter.bind(null,"Events.FetchError")).then(sendMetrics)}}function parseJSON(e){try{return JSON.parse(e)}catch(e){return logCounter("Events.JsonParseError"),{}}}function getTld(){var e=setCookieOnMainDomain("cto_tld_test","test",1);return deleteCookie("cto_tld_test"),e}function canWriteCookies(){setCookieOnMainDomain("cto_write_test","testWrite",1);var e="testWrite"===getCookie("cto_write_test");return deleteCookie("cto_write_test"),e}function createGumIframe(){var e=document.createElement("iframe"),t=extractHostname(getHighestAccessibleUrl(getHighestAccessibleWindow(window))),o=encodeURIComponent(t),r=getTld(),n={sid:sid.toJSON(),uid:idcpy.toJSON(),optout:optout.toJSON(),idfs:idfs.toJSON(),lwid:lwid.hasValue()?lwid.toJSON():"NA",tld:r,origin:"rtus",topUrl:o,rtusCallerId:parseInt(window.CALLER_ID,10)};return e.src=SYNCFRAME_URL+(o?"?topUrl="+o:"")+"#"+JSON.stringify(n),e.id=SYNCFRAME_ID,e.width="0",e.height="0",e.frameBorder="0",e.setAttribute("style","border-width:0px; margin:0px; display:none"),e}function shouldDropSyncframe(){return!document.getElementById(SYNCFRAME_ID)}function appendGumIframeIfDoesNotExist(){shouldDropSyncframe()&&(logCounter("Events.SyncframeDropped"),window.addEventListener("message",syncframeListener,!0),document.body.appendChild(createGumIframe()))}function extractHostname(e){var t=document.createElement("a");return t.href=e,t.hostname}function getHighestAccessibleUrl(e){var t=e.topFrame,o="";if(e.err)try{try{o=t.top.location.href}catch(e){var r=t.location.ancestorOrigins;o=r[r.length-1]}}catch(e){o=t.document.referrer}else o=t.location.href;return o}function getHighestAccessibleWindow(e){var t=e,o=!1;try{for(;t.parent.document!==t.document;){if(!t.parent.document){o=!0;break}t=t.parent}}catch(e){o=!0}return{topFrame:t,err:o}}function init(){if(logCounter("Events.StartInit"),idfs=Idfs.fromAllStorages(),sid=Sid.fromAllStorages(),optout=Optout.fromAllStorages(),lwid=LocalWebId.fromAllStorages(),idcpy=IdCopy.fromAllStorages(),canWriteCookies()&&(lwid.hasValue()||(lwid=LocalWebId.fromValue(generateUuid())),lwid.saveOnAllStorages(),lwid=LocalWebId.fromAllStorages()),lwid.hasValue()&&logCounter("Origin.FromLocalWebId"),window.addEventListener)if("complete"===document.readyState)appendGumIframeIfDoesNotExist();else{var e=function(){window.removeEventListener("load",e),document.removeEventListener("DOMContentLoaded",e),appendGumIframeIfDoesNotExist()};window.addEventListener("load",e,!1),document.addEventListener("DOMContentLoaded",e,!1)}if(rtusResponseFromLocalStorage=getItem(RTUS_RESPONSE_LS_KEY))return JS_CALLBACK(parseJSON(rtusResponseFromLocalStorage)),logCounter("Origin.FromLocalRtusResponse"),void sendMetrics();(idfs.hasValue()||sid.hasValue()||optout.value||idcpy.hasValue())&&(idfs.hasValue()&&logCounter("Origin.FromLocalIdfs"),sid.hasValue()&&logCounter("Origin.FromLocalSid"),optout.value&&logCounter("Origin.FromLocalOptout"),idcpy.hasValue()&&logCounter("Origin.FromIdCpy"),fetchGumResponseAndStoreItInLocalStorage(idfs,sid,optout,idcpy)),JS_CALLBACK(DEFAULT_RTUS_RESPONSE)}function logCounter(e){eventQueue.push("entry=c~Idfs.Rtus."+(window.CALLER_ID||"UnknownCaller")+"."+e+"~1")}function sendMetrics(){if(0!==eventQueue.length){var e=eventQueue.join("&"),t="https://"+window.CONFIG_CSM_DOMAIN_NAME+"/gev?"+e;if(!window.CONFIG_CSM_DOMAIN_NAME)return console.log("Pixel",t);(new Image).src=t,eventQueue=[]}}init();
})();